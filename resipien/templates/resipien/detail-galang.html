{% extends 'base_nav_user.html' %}

{% load static %}

{% block meta %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/resipien.css' %}">

<title>Buat Galang Dana</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<style>

  #btn-komen {
    background-color: #d28542;
  }

</style>

<script>

{% comment %} function submitKomentar(id) {
  $.ajax({
      type: "POST",
      url: "{% url 'resipien:add-komentar' id %}",
      data: {
        csrfmiddlewaretoken: "{{ csrf_token }}", 
        komen: $("#komen").val(),
      },
        dataType: "json",
        success: function () {
        refresh();
        document.getElementById("komentar").value = "";
      },
  });
} {% endcomment %}

</script>

{% endblock meta %}


{% block content %}

{% load crispy_forms_tags %}

<div id="container-detail">
  <div id="container-data">
    <div id="container-gambar">
      {% if galang.gambar %}
        <img id="img-detail" src="{{ galang.gambar.url}}" style="max-height:300px">
      {% else %}
        <img id="img-detail" src="{% static 'images/noimage.jpeg' %}" style="max-height:300px">
      {% endif %}
    </div>
    <h1 id="judul-galang">{{galang.judul}}</h1>
    
    {% load humanize %}
    <span><strong>Rp{{jumlah_semua_bid|floatformat:3|intcomma}}</strong> terkumpul dari {{galang.target}}</span>
    <span class="float-end">{{galang.tanggal_berakhir|timeuntil}}</span>
    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-label="Basic example" style="width: {{rasio_donasi}}%" aria-valuenow="{{rasio_donasi}}" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <div class="alert alert-info" role="alert">
      <strong>{{barang_lelang_penyumbang.count}} lelang</strong> hasilnya ditujukan untuk galang dana ini
    </div>
    <a href="{% url 'lelang:create_lelang' galang.pk %}"><button type="button" class="btn btn-primary">Buat Lelang Untuk Galang Dana Ini</button></a>
    <h3>Deskripsi</h3>
    <p>{{galang.deskripsi}}</p>
    {% if barang_lelang_penyumbang %}
    <h4 class="text-center ">Daftar Lelang Penyumbang</h4>
    <div class="row row-cols-1 row-cols-xs-2 row-cols-sm-2 row-cols-lg-3 g-5 mb-5" id="container-index-lelang"> 
      {% for barang_lelang in barang_lelang_penyumbang %}
      <div class="col">
        <a href="{% url 'lelang:rincian_lelang' barang_lelang.pk %}" style="text-decoration:none; color:black;">
            <div class="card h-100 ">
                <div class="img-container">
                    <img src="{{barang_lelang.gambar.url}}" class="card-img-top" alt="barang_lelang.nama_barang" style="max-width: 100%;max-height: 100%;object-fit: cover;"> 
                </div>
                <div class="card-body"> 
                    <div class="clearfix mb-3">
                      {% if barang_lelang.status_keaktifan %}
                      <span class="float-start badge rounded-pill bg-success">Aktif</span>
                      {% else %}
                      <span class="float-start badge rounded-pill bg-danger">Tidak Aktif</span>
                      {% endif %}
                    </div> 
                    <h5 class="card-title" style="color: rgb(70, 70, 70);">{{barang_lelang.nama_barang}}</h5>
                    <h5><strong>Rp{{barang_lelang.bid_tertinggi|intcomma}}</strong></h5>
                    {% if barang_lelang.status_keaktifan %}
                    <span class="badge bg-primary">{{ barang_lelang.tanggal_berakhir|timeuntil }}</span>
                    {% else %}
                    <span class="badge bg-primary">Lelang Selesai</span>
                    {% endif %}
                </div> 
            </div> 
        </a>
      </div> 
      {% endfor %}
    </div>
    {% endif %}
    <form id="formK" method="POST" >
      {% csrf_token %}
      <textarea id="komen" rows="7" cols="80" placeholder="Tulis komentar..."></textarea>
      <a role="button"id="btn-komen" class="btn" onclick="submitKomentar('{{galang.id}}')" >Tambah Komentar</a>
    </form>
    
    
    <div id="komentar"></div>
    {% for komentar in komen %}
      <h4>{{komentar.user.username}}</h4>
      <p>{{komentar.komentar}}</p>
    {% endfor %}

  </div>
</div>
  
{% endblock content %}
